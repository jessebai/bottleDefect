function [BW,maskedImage] = segmentImage(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter App
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter App. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 06-Jul-2018
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph cut
foregroundInd = [45370 46932 46936 46946 47336 47337 47714 47779 47784 47812 47815 48133 48198 48520 48573 48900 48903 48914 48957 49358 49694 49698 49774 50164 50535 51273 51274 ];
backgroundInd = [5758 5765 5770 6535 6557 6558 6561 6572 6588 6950 6956 7708 7736 7783 8489 8933 9662 10834 10884 11219 11223 11335 11607 11993 12087 13559 14487 15634 16301 17867 18029 19042 19779 19792 19798 19799 19930 19940 20194 20608 20730 21373 21933 22516 22552 22699 22959 24516 24864 24918 25061 25254 25647 25897 26483 26485 26863 26864 26868 26871 26873 27724 28228 28547 29355 29529 29923 30000 30150 30155 30159 30394 30753 30951 30957 30966 31180 31365 32144 32155 32157 32673 32945 32979 33734 33884 34670 35091 35096 35097 35098 35311 35456 35503 36518 36880 37673 37830 38875 39355 39592 39796 41626 42000 43286 43524 44929 45134 45163 45289 45323 45491 46028 46029 46306 46494 46823 47113 47201 47236 47603 48022 48075 48078 48242 49093 49175 49940 50240 50357 50383 51450 51616 51899 51931 51932 51941 52326 53077 53167 53351 53548 53582 53807 53863 53902 53903 53906 54294 54295 54557 54721 54977 55042 55770 56332 56507 56516 56657 56902 56903 56904 57403 58125 58503 59006 59437 59830 60481 60618 60944 61266 61365 61427 61604 61800 61835 61866 61875 61895 61913 61934 62151 62152 62202 62258 62348 62442 62589 62938 63305 63332 63334 63378 63547 64010 64410 64522 64560 64561 64738 64743 65141 65148 65350 65351 65546 65580 65715 65740 65974 66059 66093 66142 66337 66341 66344 66346 66510 66513 66516 66935 67337 67540 67550 67633 67742 67757 68285 68558 68576 68813 69109 69498 69994 70279 70559 71062 71078 71175 71359 71819 71836 71844 71851 71869 71964 72165 72188 72359 72626 72835 73001 73544 73550 73598 73604 73608 73611 73614 73799 74344 74356 74368 74378 74403 74968 75367 75754 75797 75980 76149 76542 76557 76558 76938 76940 76943 76946 77163 77501 77716 77952 78498 78546 79135 79924 80065 80319 80713 80896 81106 81107 81469 81504 81633 81899 81900 81903 81905 81906 81909 81913 81916 81921 81925 82716 83115 83513 83593 84697 85160 86336 86563 87338 87457 87733 87735 87903 89470 89823 90644 91399 92210 92974 93383 93762 94551 94553 94556 ];
L = superpixels(X,303,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1)   = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2:3) = (in(:,:,2:3) + 100) / 200;  % a* and b* range is [-100,100].

end
